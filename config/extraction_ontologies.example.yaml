# extraction_ontologies.example.yaml
#
# Maps group_id → lane-specific extraction ontology.
# Each lane defines:
#   entity_types      — what kinds of entities to extract
#   relationship_types — what edges connect those entities
#   intent_guidance   — per-lane LLM focus instructions (canonical field)
#   extraction_mode   — 'permissive' (default) or 'constrained_soft'
#   extraction_emphasis — legacy alias for intent_guidance (still works)
#
# Extraction modes:
#   permissive (default): extract broadly; all relation types allowed.
#   constrained_soft: ontology-conformant mode — uses dedicated prompt
#     branches and code-level edge canonicalization + noise filtering.
#     Use for high-fidelity domain extraction where generic edges add noise.
#
# group_ids not listed here fall back to the default entity types
# configured in your GraphitiConfig (graphiti.entity_types).
#
# Schema version: 1
# Docs: docs/custom-ontologies.md

schema_version: 1

# ─────────────────────────────────────────────────────────────────────
# Lane 1: Customer Support Tickets  [permissive — default]
# ─────────────────────────────────────────────────────────────────────
customer_support_tickets:
  # extraction_mode: permissive  # this is the default; omit if permissive
  intent_guidance: >
    Focus on extracting the customer's core problem, the product
    features involved, resolution steps taken, and whether the issue
    was resolved or escalated. Prioritize actionable patterns over
    one-off complaints.

  entity_types:
    - name: CustomerIssue
      description: >
        A specific problem or complaint reported by a customer.
        Extract the symptom, affected feature, and severity if stated.

    - name: ProductFeature
      description: >
        A product capability, module, or component referenced in the ticket.

    - name: ResolutionStep
      description: >
        An action taken by support staff to diagnose or fix the issue.

    - name: Workaround
      description: >
        A temporary fix or alternative path suggested to the customer.

  relationship_types:
    - name: AFFECTS
      description: "CustomerIssue → ProductFeature it impacts"

    - name: RESOLVED_BY
      description: "CustomerIssue → ResolutionStep that fixed it"

    - name: WORKED_AROUND_BY
      description: "CustomerIssue → Workaround applied"

    - name: ESCALATED_TO
      description: "CustomerIssue → team or tier it was escalated to"

# ─────────────────────────────────────────────────────────────────────
# Lane 2: Product Feedback
# ─────────────────────────────────────────────────────────────────────
product_feedback:
  extraction_emphasis: >
    Extract feature requests, usability observations, and sentiment
    signals. Distinguish between explicit requests ("I want X") and
    implicit needs ("I keep having to do Y manually"). Capture the
    user persona or segment when identifiable.

  entity_types:
    - name: FeatureRequest
      description: >
        A specific capability or improvement the user wants.

    - name: UsabilityObservation
      description: >
        A friction point, confusion, or delight moment in the user experience.

    - name: UserPersona
      description: >
        The type of user providing feedback (e.g., power user, new user,
        admin). Extract only when identifiable from context.

    - name: CompetitorMention
      description: >
        A reference to a competing product or alternative tool.

  relationship_types:
    - name: REQUESTED_BY
      description: "FeatureRequest → UserPersona who asked for it"

    - name: OBSERVED_IN
      description: "UsabilityObservation → product area where it occurred"

    - name: COMPARED_TO
      description: "ProductFeature → CompetitorMention"

    - name: BLOCKED_BY
      description: "FeatureRequest → existing limitation or dependency"

# ─────────────────────────────────────────────────────────────────────
# Lane 3: Engineering Incidents
# ─────────────────────────────────────────────────────────────────────
engineering_incidents:
  extraction_emphasis: >
    Focus on root causes, blast radius, remediation steps, and
    lessons learned. Extract specific tool/API behaviors that
    contributed to the incident. Prioritize patterns that prevent
    recurrence over narrative details.

  entity_types:
    - name: IncidentReport
      description: >
        A production incident or outage event, including severity and duration.

    - name: RootCause
      description: >
        The underlying technical reason the incident occurred.

    - name: RemediationStep
      description: >
        An action taken to resolve the incident or prevent recurrence.

    - name: AffectedService
      description: >
        A service, component, or system impacted by the incident.

    - name: ToolApiBehavior
      description: >
        A specific tool or API quirk that contributed to the incident
        (e.g., unexpected return value, race condition, config gotcha).

  relationship_types:
    - name: CAUSED_BY
      description: "IncidentReport → RootCause"

    - name: FIXED_BY
      description: "IncidentReport → RemediationStep"

    - name: IMPACTED
      description: "IncidentReport → AffectedService"

    - name: PREVENTS
      description: "RemediationStep → future IncidentReport pattern"

    - name: CONTRIBUTED_TO
      description: "ToolApiBehavior → IncidentReport"

# ─────────────────────────────────────────────────────────────────────
# Lane 4: Content Inspiration  [constrained_soft — ontology-conformant]
#
# Use constrained_soft when:
# - The graph should closely mirror a defined domain model
# - Generic edges (RELATES_TO, MENTIONS, etc.) would add noise
# - Near-miss edge names need snapping to canonical names
# ─────────────────────────────────────────────────────────────────────
content_inspiration:
  extraction_mode: constrained_soft

  intent_guidance: >
    Focus on rhetorical techniques, structural patterns, and voice qualities.
    Extract what makes content distinctive — specific moves, patterns, and
    characteristics. Do NOT extract generic topic nodes or off-topic relationships.
    Conform strictly to the defined FACT_TYPES: USES_MOVE, OPENS_WITH, EXHIBITS.
    Do not emit RELATES_TO, MENTIONS, IS_RELATED_TO, or other generic connectors.

  entity_types:
    - name: RhetoricalMove
      description: >
        A specific writing or presentation technique (e.g. cold open with
        absurd analogy, one-liner callback, dialectical pivot). Extract the
        technique name and a short description of how it's used.

    - name: HookPattern
      description: >
        A first-line or opening strategy (e.g. provocative question, contrarian
        statement, unexpected juxtaposition). Focus on the structural opening
        technique, not the topic.

    - name: VoiceQuality
      description: >
        A tone or register characteristic (e.g. irreverent-casual,
        deadpan-authoritative, erudite-compressed). Extract only when
        clearly evident from the writing style.

  relationship_types:
    - name: USES_MOVE
      description: "Content piece → RhetoricalMove it employs"

    - name: OPENS_WITH
      description: "Content piece → HookPattern used as the opening"

    - name: EXHIBITS
      description: "Content piece → VoiceQuality it demonstrates"

# Note on constrained_soft code enforcement:
# After LLM extraction, two passes run automatically:
# 1. Near-miss canonicalization: "USE_MOVE" → "USES_MOVE" (difflib ≥ 0.78)
# 2. Generic noise filter: RELATES_TO, MENTIONS, etc. → dropped
# Domain-specific off-ontology edges (e.g. WRITTEN_IN_RESPONSE_TO) are kept.
