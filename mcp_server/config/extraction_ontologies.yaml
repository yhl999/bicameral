schema_version: "2026-02-17"

om_extractor:
  model_id: "gpt-5.1-codex-mini"
  prompt_template: |-
    You are the Observational Memory extractor.
    Produce deterministic mutation candidates from transcript chunks.
    Preserve source provenance and avoid speculative claims.

# Lane-Specific Extraction Ontologies
#
# Maps group_id → entity types, relationship types, and extraction emphasis.
# Adding a new lane requires ONLY a new block here — zero code changes.
#
# Schema per lane:
#   <group_id>:
#     entity_types:
#       - name: <EntityTypeName>
#         description: <what the LLM should extract>
#     relationship_types:
#       - name: <RELATIONSHIP_NAME>
#         description: <meaning>
#     extraction_emphasis: <prompt hint guiding the LLM's focus>

# ─────────────────────────────────────────────
# Content Inspiration — Short-Form
# ─────────────────────────────────────────────
s1_inspiration_short_form:
  extraction_emphasis: >-
    Focus on hooks, compression, punch, and engagement triggers.
    Prioritize rhetorical moves and voice/tone over topic or thesis.
    Extract what makes short-form content effective — first-line formulas,
    compression techniques, and engagement signals.

  entity_types:
    - name: RhetoricalMove
      description: "A specific technique used in the piece (e.g. cold open with absurd analogy, one-liner callback)"
    - name: HookPattern
      description: "First-line or opening strategy (e.g. provocative question, contrarian statement, unexpected juxtaposition)"
    - name: VoiceQuality
      description: "Tone or register characteristic (e.g. irreverent-casual, deadpan-authoritative, erudite-compressed)"
    - name: EngagementSignal
      description: "What made the piece resonate or go viral (e.g. ratio bait, tribal identity signal, counterintuitive data point)"
    - name: AuthorStyle
      description: "The writer's broader style archetype (e.g. Tyler Cowen — compressed erudition, Balaji — thread-as-essay)"
    - name: CompressionTechnique
      description: "How complex ideas are compressed (e.g. metaphor substitution, assumed shared context, implication over statement)"

  relationship_types:
    - name: USES_MOVE
      description: "Piece → RhetoricalMove"
    - name: OPENS_WITH
      description: "Piece → HookPattern"
    - name: EXHIBITS
      description: "Piece → VoiceQuality"
    - name: TRIGGERED
      description: "Piece → EngagementSignal"
    - name: AUTHORED_BY
      description: "Piece → AuthorStyle"
    - name: COMPRESSES_VIA
      description: "Piece → CompressionTechnique"

# ─────────────────────────────────────────────
# Content Inspiration — Long-Form
# ─────────────────────────────────────────────
s1_inspiration_long_form:
  extraction_emphasis: >-
    Focus on argument structure, narrative arc, transitions, and sustained voice.
    Extract how long-form pieces build and maintain reader engagement across sections.
    Prioritize structural and rhetorical patterns over individual facts or claims.

  entity_types:
    - name: RhetoricalMove
      description: "Long-form technique (e.g. extended analogy across sections, dialectical pivot, callback close)"
    - name: NarrativeArc
      description: "Overall structural pattern (e.g. thesis-antithesis-synthesis, chronological buildup to reveal, nested stories)"
    - name: ArgumentStructure
      description: "How the argument is built (e.g. evidence stacking, concession-then-reframe, first-principles derivation)"
    - name: VoiceQuality
      description: "Tone or register in long-form (e.g. essayistic-intimate, academic-accessible, storyteller-with-data)"
    - name: TransitionTechnique
      description: "How sections or ideas connect (e.g. rhetorical question bridge, anecdote pivot, tempo shift)"
    - name: EngagementSignal
      description: "What made the piece resonate (e.g. shareable thesis statement, quotable paragraph, unexpected conclusion)"
    - name: AuthorStyle
      description: "Writer's archetype (e.g. Arthur Hayes — storytelling + macro thesis, Paul Graham — simple clarity)"
    - name: OpeningStrategy
      description: "Long-form hook approach (e.g. in-medias-res anecdote, bold claim first sentence, scene-setting)"

  relationship_types:
    - name: USES_MOVE
      description: "Piece → RhetoricalMove"
    - name: STRUCTURED_AS
      description: "Piece → NarrativeArc or ArgumentStructure"
    - name: EXHIBITS
      description: "Piece → VoiceQuality"
    - name: TRANSITIONS_VIA
      description: "Section → TransitionTechnique"
    - name: AUTHORED_BY
      description: "Piece → AuthorStyle"
    - name: OPENS_WITH
      description: "Piece → OpeningStrategy"
    - name: TRIGGERED
      description: "Piece → EngagementSignal"

# ─────────────────────────────────────────────
# Writing Samples — Yuan's Own
# ─────────────────────────────────────────────
s1_writing_samples:
  extraction_emphasis: >-
    Focus on voice fingerprint, structural patterns, and register variation.
    Extract what makes this writing uniquely Yuan's — characteristic moves,
    signature phrases, tone shifts. Keep topic extraction light.
    Weight unassisted and unedited samples higher for voice authenticity.

  entity_types:
    - name: VoiceFingerprint
      description: "Characteristic writing move unique to the author (e.g. Machiavelli-meets-f-bomb register shift, parenthetical self-deprecation)"
    - name: StructuralPattern
      description: "How the author builds or organizes (e.g. hook → context → thesis → evidence → callback, list-with-commentary)"
    - name: RegisterMarker
      description: "Signal of register level (e.g. slang density, citation formality, sentence length variation)"
    - name: SignaturePhrase
      description: "Recurring distinctive language — specific phrases, characteristic word choices, verbal tics"
    - name: ToneShift
      description: "Where or how register changes within a piece (e.g. opens casual, pivots to technical, closes with joke)"

  relationship_types:
    - name: DEMONSTRATES
      description: "Sample → VoiceFingerprint"
    - name: FOLLOWS
      description: "Sample → StructuralPattern"
    - name: SIGNALS
      description: "Sample → RegisterMarker"
    - name: CONTAINS
      description: "Sample → SignaturePhrase"
    - name: SHIFTS_VIA
      description: "Sample → ToneShift"

# ─────────────────────────────────────────────
# Content Strategy
# ─────────────────────────────────────────────
s1_content_strategy:
  extraction_emphasis: >-
    Focus on actionable platform knowledge and engagement mechanics.
    Extract concrete tactics, proven formulas, and anti-patterns.
    Prioritize specificity — platform-specific mechanics over generic advice.

  entity_types:
    - name: PlatformMechanic
      description: "How a platform's algorithm or system works (e.g. Twitter rewards early engagement velocity, quote tweets boost less than replies)"
    - name: HookTemplate
      description: "Proven first-line formula (e.g. Thread: Here's what nobody tells you about X, 'Unpopular opinion:' framing)"
    - name: DistributionTactic
      description: "Strategy for reach or engagement (e.g. reply to high-follower accounts within 15 min, thread with standalone first tweet)"
    - name: AntiPattern
      description: "What kills engagement or looks bad (e.g. hashtag spam, self-promotional tone, engagement bait without substance)"
    - name: AudiencePsychology
      description: "What specific audiences respond to (e.g. crypto audience rewards contrarian takes with evidence, VC audience shares builder insight content)"

  relationship_types:
    - name: EXPLOITS
      description: "Tactic → PlatformMechanic"
    - name: TARGETS
      description: "Tactic → AudiencePsychology"
    - name: COUNTERS
      description: "AntiPattern → what it prevents"
    - name: USES_HOOK
      description: "Tactic → HookTemplate"
    - name: SUPERSEDED_BY
      description: "Old mechanic → new mechanic (staleness chain)"

# ─────────────────────────────────────────────
# Engineering Learnings
# ─────────────────────────────────────────────
engineering_learnings:
  extraction_emphasis: >-
    Focus on what worked, what failed, why, and how to prevent recurrence.
    Extract specific tool behaviors, architecture decisions, and performance patterns.
    Capture root causes and remediation steps, not just symptoms.

  entity_types:
    - name: FailurePattern
      description: "What went wrong and why (e.g. FalkorDB GRAPH.QUERY on empty graph returns no rows, not error)"
    - name: SuccessPattern
      description: "What worked well (e.g. nohup + log redirect prevents CLR output-buffer SIGKILL)"
    - name: ReviewPattern
      description: "What reviewers consistently catch (e.g. missing error handling on async graph operations)"
    - name: SecurityFinding
      description: "Security-relevant discovery (e.g. content scanner missed canary phrase injection pattern)"
    - name: ToolApiBehavior
      description: "Specific tool or API quirk or gotcha (e.g. gh issue comment with backticks in zsh requires heredoc)"
    - name: ArchitectureDecision
      description: "Why we chose X over Y (e.g. chose per-group FalkorDB graphs over namespace-only segregation)"
    - name: PerformancePattern
      description: "What is slow or fast and why (e.g. long-form extraction ~3 min/episode due to dense chunk size)"
    - name: DependencyCompatibility
      description: "Library or version interaction (e.g. FalkorDB v4.16.3 doesn't support EXISTS subquery)"

  relationship_types:
    - name: CAUSED_BY
      description: "Failure → root cause"
    - name: FIXED_BY
      description: "Failure → remediation or success pattern"
    - name: PREVENTS
      description: "Pattern → future failure"
    - name: AFFECTS
      description: "ToolApiBehavior → specific tool or service"
    - name: SUPERSEDES
      description: "New learning → stale old learning"
    - name: DECIDED_BECAUSE
      description: "ArchitectureDecision → tradeoff or rationale"
    - name: CONSTRAINS
      description: "DependencyCompatibility → what it limits"

# ─────────────────────────────────────────────
# Self-Audit / Operational Learnings
# ─────────────────────────────────────────────
learning_self_audit:
  extraction_emphasis: >-
    Focus on what went wrong in assistant operations, why, and how to prevent it.
    Weight MISSes higher than HITs for entity creation priority.
    Extract concrete operational rules and remediation steps.

  entity_types:
    - name: ToolBehavior
      description: "Tool-specific operational quirk (e.g. TFL releases 2 months ahead, not 1 — Feb drop covers through March)"
    - name: OperationalRule
      description: "Process or policy that should be followed (e.g. Always use update-with-hotfixes.sh for OpenClaw updates)"
    - name: SecurityGap
      description: "Discovered security weakness in operations (e.g. Content scanner missed canary phrase injection)"
    - name: PreferenceMiss
      description: "User preference that was wrong or missed (e.g. Yuan prefers pushy instant pings, not daily digests)"
    - name: Remediation
      description: "The fix applied to prevent recurrence (e.g. Added canary pattern to content-scanner rules)"

  relationship_types:
    - name: CAUSED_BY
      description: "Gap or Miss → root cause"
    - name: FIXED_BY
      description: "Gap or Miss → Remediation"
    - name: PREVENTS
      description: "Rule or Remediation → future gap"
    - name: AFFECTS
      description: "ToolBehavior → specific tool or service"
    - name: SUPERSEDES
      description: "New learning → old stale learning"

# ─────────────────────────────────────────────
# Sessions Memory — Main Lane
# ─────────────────────────────────────────────
s1_sessions_main:
  extraction_mode: constrained_soft
  extraction_emphasis: >-
    Focus on durable facts about the user: preferences, requirements, procedures,
    people, places, events, and decisions. Extract concrete operational knowledge
    that will remain useful across future sessions. Avoid ephemeral conversation
    scaffolding — prioritize signal over noise.

  entity_types:
    - name: Preference
      description: "A stated or inferred preference (e.g. prefers email summaries in bullet form, dislikes excessive jargon)"
    - name: Requirement
      description: "A hard constraint or requirement (e.g. meetings must include Google Meet link, no calls before 10:30am)"
    - name: Procedure
      description: "A repeatable process or workflow (e.g. how to update OpenClaw with hotfix carry-forward)"
    - name: Location
      description: "A place that matters (e.g. East Village apartment, BCAP office at X address)"
    - name: Event
      description: "A scheduled or past event (e.g. crypto conference, quarterly LP meeting)"
    - name: Organization
      description: "A company, fund, or group (e.g. Blockchain Capital, FranklinDAO, Antfarm)"
    - name: Document
      description: "A referenced file, doc, or resource (e.g. AGENTS.md, quarterly report draft)"
    - name: Topic
      description: "A recurring subject or domain (e.g. crypto VC, content strategy, personal health)"
    - name: Object
      description: "A physical or digital artifact (e.g. wine bottle recommendation, code snippet)"

  relationship_types:
    - name: RELATES_TO
      description: "General semantic relationship between two entities (catch-all for backwards compatibility)"
    - name: PREFERS
      description: "Entity or person → Preference (what is preferred)"
    - name: REQUIRES
      description: "Entity or task → Requirement (what is needed)"
    - name: FOLLOWS
      description: "Agent or person → Procedure (workflow used)"
    - name: LOCATED_AT
      description: "Event or Organization → Location"
    - name: ATTENDED
      description: "Person → Event"
    - name: PART_OF
      description: "Entity → Organization or group it belongs to"
    - name: REFERENCES
      description: "Entity or session → Document or resource"
    - name: CONCERNS
      description: "Session or episode → Topic (primary subject)"

# ─────────────────────────────────────────────
# Sessions Memory — Pilot Lane (FR-11, 2026-02-27)
# ─────────────────────────────────────────────
s1_pilot_fr11_20260227:
  extraction_mode: constrained_soft
  extraction_emphasis: >-
    Pilot lane for FR-11 observe-only conformance validation. Mirrors the
    sessions_main ontology. Focus on the same durable facts — preferences,
    requirements, procedures, events, and organizations — but scoped to the
    pilot extraction window. Used for conformance metric calibration only;
    does not gate any production ingestion.

  entity_types:
    - name: Preference
      description: "A stated or inferred preference"
    - name: Requirement
      description: "A hard constraint or requirement"
    - name: Procedure
      description: "A repeatable process or workflow"
    - name: Location
      description: "A place that matters"
    - name: Event
      description: "A scheduled or past event"
    - name: Organization
      description: "A company, fund, or group"
    - name: Document
      description: "A referenced file, doc, or resource"
    - name: Topic
      description: "A recurring subject or domain"
    - name: Object
      description: "A physical or digital artifact"

  relationship_types:
    - name: RELATES_TO
      description: "General semantic relationship (catch-all for backwards compatibility)"
    - name: PREFERS
      description: "Person or entity → Preference"
    - name: REQUIRES
      description: "Entity or task → Requirement"
    - name: FOLLOWS
      description: "Agent or person → Procedure"
    - name: LOCATED_AT
      description: "Event or Organization → Location"
    - name: ATTENDED
      description: "Person → Event"
    - name: PART_OF
      description: "Entity → Organization"
    - name: REFERENCES
      description: "Entity → Document or resource"
    - name: CONCERNS
      description: "Session or episode → Topic"

# ─────────────────────────────────────────────
# Sessions Memory — Pilot Lanes (FR-11, 2026-02-28)
# Mirrors s1_pilot_fr11_20260227. Added for v1 and v2 pilot rerun evaluations.
# ─────────────────────────────────────────────
s1_pilot_fr11_20260228:
  extraction_mode: constrained_soft
  extraction_emphasis: >-
    Pilot lane for FR-11 observe-only conformance validation (2026-02-28 run).
    Same ontology as s1_pilot_fr11_20260227.

  entity_types:
    - name: Preference
      description: "A stated or inferred preference"
    - name: Requirement
      description: "A hard constraint or requirement"
    - name: Procedure
      description: "A repeatable process or workflow"
    - name: Location
      description: "A place that matters"
    - name: Event
      description: "A scheduled or past event"
    - name: Organization
      description: "A company, fund, or group"
    - name: Document
      description: "A referenced file, doc, or resource"
    - name: Topic
      description: "A recurring subject or domain"
    - name: Object
      description: "A physical or digital artifact"

  relationship_types:
    - name: RELATES_TO
      description: "General semantic relationship (catch-all for backwards compatibility)"
    - name: PREFERS
      description: "Person or entity → Preference"
    - name: REQUIRES
      description: "Entity or task → Requirement"
    - name: FOLLOWS
      description: "Agent or person → Procedure"
    - name: LOCATED_AT
      description: "Event or Organization → Location"
    - name: ATTENDED
      description: "Person → Event"
    - name: PART_OF
      description: "Entity → Organization"
    - name: REFERENCES
      description: "Entity → Document or resource"
    - name: CONCERNS
      description: "Session or episode → Topic"

s1_pilot_fr11_20260228_v2:
  extraction_mode: constrained_soft
  extraction_emphasis: >-
    Pilot lane for FR-11 observe-only conformance validation (2026-02-28 v2 rerun,
    with EVAL-1/2/3 fixes applied). Same ontology as s1_pilot_fr11_20260227.

  entity_types:
    - name: Preference
      description: "A stated or inferred preference"
    - name: Requirement
      description: "A hard constraint or requirement"
    - name: Procedure
      description: "A repeatable process or workflow"
    - name: Location
      description: "A place that matters"
    - name: Event
      description: "A scheduled or past event"
    - name: Organization
      description: "A company, fund, or group"
    - name: Document
      description: "A referenced file, doc, or resource"
    - name: Topic
      description: "A recurring subject or domain"
    - name: Object
      description: "A physical or digital artifact"

  relationship_types:
    - name: RELATES_TO
      description: "General semantic relationship (catch-all for backwards compatibility)"
    - name: PREFERS
      description: "Person or entity → Preference"
    - name: REQUIRES
      description: "Entity or task → Requirement"
    - name: FOLLOWS
      description: "Agent or person → Procedure"
    - name: LOCATED_AT
      description: "Event or Organization → Location"
    - name: ATTENDED
      description: "Person → Event"
    - name: PART_OF
      description: "Entity → Organization"
    - name: REFERENCES
      description: "Entity → Document or resource"
    - name: CONCERNS
      description: "Session or episode → Topic"

# ─────────────────────────────────────────────────────────────────────────────
# OM-path pilot — 2026-02-28 v3
# Uses om_compressor/om_extractor path, NOT mcp_ingest_sessions add_memory.
# Isolated namespace for FR-11 OM-path verification.
# Entity types and relation types reflect the OM ontology (OMNode schema).
# ─────────────────────────────────────────────────────────────────────────────
s1_pilot_om_path_20260228_v3:
  extraction_mode: constrained_soft
  extraction_emphasis: >-
    OM-path pilot for FR-11 verification (2026-02-28 v3). Validates that
    om_compressor extracts structured OM observations with correct typing.
    Uses om_extractor rule-based path; model pinned to gpt-5.1-codex-mini.

  entity_types:
    - name: Insight
      description: "A durable observational insight extracted from session transcripts"
    - name: Pattern
      description: "A recurring behaviour or structural pattern"
    - name: Requirement
      description: "A hard constraint or system requirement"
    - name: Preference
      description: "A stated or inferred user preference"
    - name: Decision
      description: "A resolved choice or architectural decision"
    - name: Problem
      description: "An identified problem or failure mode"

  relationship_types:
    - name: MOTIVATES
      description: "OM node A motivates or drives OM node B"
    - name: GENERATES
      description: "OM node A generates or produces OM node B"
    - name: SUPERSEDES
      description: "OM node A supersedes or replaces OM node B"
    - name: ADDRESSES
      description: "OM node A addresses or resolves OM node B"
    - name: RESOLVES
      description: "OM node A resolves OM node B (conclusion)"

# ─────────────────────────────────────────────
# v4-small: OM-1 metadata contamination fix verification pilot (2026-02-28)
# Small bounded run (≤3 chunks / ≤150 messages) to confirm contamination→0%.
# ─────────────────────────────────────────────
s1_pilot_om_path_20260228_v4_small:
  extraction_mode: constrained_soft
  extraction_emphasis: >-
    OM-path pilot for FR-11 v4-small (2026-02-28). Verifies OM-1 metadata
    contamination fix in om_compressor path and extractor-path verification
    event emission. Small bounded run (≤3 chunks / ≤150 messages). Model
    pinned to gpt-5.1-codex-mini. Namespace isolated; no production data.

  entity_types:
    - name: Insight
      description: "A durable observational insight extracted from session transcripts"
    - name: Pattern
      description: "A recurring behaviour or structural pattern"
    - name: Requirement
      description: "A hard constraint or system requirement"
    - name: Preference
      description: "A stated or inferred user preference"
    - name: Decision
      description: "A resolved choice or architectural decision"
    - name: Problem
      description: "An identified problem or failure mode"

  relationship_types:
    - name: MOTIVATES
      description: "OM node A motivates or drives OM node B"
    - name: GENERATES
      description: "OM node A generates or produces OM node B"
    - name: SUPERSEDES
      description: "OM node A supersedes or replaces OM node B"
    - name: ADDRESSES
      description: "OM node A addresses or resolves OM node B"
    - name: RESOLVES
      description: "OM node A resolves OM node B (conclusion)"
